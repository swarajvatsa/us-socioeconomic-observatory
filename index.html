<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Socio-Economic Observatory: Financial, AI & Actuarial Analysis</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #1a1a1a;
            --text-main: #ffffff;
            --text-sub: #a0a0a0;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-purple: #8b5cf6;
            --accent-orange: #f59e0b;
            --border-color: #333333;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            overflow: hidden;
            display: flex;
            height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- Left: Visualization Canvas --- */
        #viz-panel {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #header {
            padding: 16px 32px;
            background: #000000;
            border-bottom: 1px solid var(--border-color);
            z-index: 10;
            box-shadow: 0 2px 4px rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content h1 {
            margin: 0;
            font-size: 22px;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: #ffffff;
        }

        .header-content .subtitle {
            margin: 4px 0 0 0;
            color: var(--text-sub);
            font-size: 13px;
        }

        #legend {
            display: flex;
            gap: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .legend-item { 
            display: flex; 
            align-items: center; 
            gap: 6px; 
            color: var(--text-sub); 
            background: #1a1a1a; 
            padding: 6px 12px; 
            border-radius: 20px; 
            border: 1px solid var(--border-color); 
            transition: all 0.2s;
        }
        .legend-item:hover { background: #222222; border-color: #444444; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }

        #chart-container {
            flex: 1;
            overflow: auto;
            background: #000000;
            cursor: grab;
            position: relative;
        }
        #chart-container:active { cursor: grabbing; }

        /* --- Right: Detail Inspector --- */
        #inspector-panel {
            width: 480px;
            background: #0a0a0a;
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 0;
            box-shadow: -5px 0 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            z-index: 20;
        }

        .inspector-inner {
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* --- Inspector Components --- */
        .panel-header { border-bottom: 2px solid var(--border-color); padding-bottom: 20px; }
        .role-title { font-size: 26px; font-weight: 800; color: #ffffff; line-height: 1.1; margin: 0; letter-spacing: -0.5px; }
        .role-meta { 
            font-family: 'JetBrains Mono', monospace; 
            font-size: 11px; 
            color: #a0a0a0; 
            margin-top: 10px; 
            display: flex; 
            gap: 15px; 
        }
        .meta-tag { background: #1a1a1a; padding: 2px 6px; border-radius: 4px; color: #d0d0d0; border: 1px solid #333333; }
        
        .section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 800;
            color: #808080;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section-title::after { content: ''; flex: 1; height: 1px; background: var(--border-color); }
        .section-title.fin { color: var(--accent-blue); }
        .section-title.ai { color: var(--accent-purple); }
        .section-title.age { color: var(--accent-orange); }

        /* Generic Card Style */
        .data-card { 
            background: #0f0f0f; 
            border: 1px solid var(--border-color); 
            border-radius: 10px; 
            padding: 16px; 
            box-shadow: 0 1px 3px rgba(255,255,255,0.02);
            position: relative;
            overflow: hidden;
        }

        /* Distribution Charts */
        .dist-chart-container { height: 90px; width: 100%; position: relative; margin-bottom: 12px; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .stat-box { display: flex; flex-direction: column; }
        .stat-label { font-size: 10px; text-transform: uppercase; color: #808080; font-weight: 700; margin-bottom: 2px;}
        .stat-value { font-size: 15px; font-weight: 700; color: #ffffff; font-feature-settings: "tnum"; }
        
        .nuance-text { 
            font-size: 12px; 
            color: #b0b0b0; 
            font-style: italic; 
            background: #1a1a1a; 
            padding: 10px; 
            border-radius: 6px; 
            margin-top: 12px; 
            line-height: 1.5; 
            border-left: 3px solid #333333; 
        }

        /* AI Specifics */
        .ai-card { background: #0f0f0f; }
        .mech-text { font-size: 13px; line-height: 1.5; color: #e0e0e0; margin-bottom: 16px; font-weight: 500;}
        
        .timeline-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; text-align: center; }
        .time-col { background: #1a1a1a; border: 1px solid #333333; border-radius: 6px; padding: 8px 4px; transition: transform 0.2s;}
        .time-col:hover { transform: translateY(-2px); box-shadow: 0 2px 5px rgba(255,255,255,0.05); }
        .time-head { font-size: 9px; color: #808080; display: block; margin-bottom: 4px; text-transform: uppercase; font-weight: 700;}
        .time-val { font-size: 13px; font-weight: 800; display: block; color: #ffffff; }
        
        .pos { color: var(--accent-green); }
        .neg { color: var(--accent-red); }
        .neu { color: var(--text-sub); }

        /* Paradox Box */
        .paradox-box {
            background: #1a0f0f;
            border: 1px solid #4a1a1a;
            border-left: 4px solid #ef4444;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
        }
        .paradox-title { color: #ef4444; font-weight: 800; font-size: 11px; margin-bottom: 6px; display: flex; align-items: center; gap: 6px; text-transform: uppercase;}
        .paradox-text { font-size: 12px; color: #fca5a5; line-height: 1.4; }

        /* Age Box */
        .age-card { border-top: 3px solid var(--accent-orange); }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 4px;
            padding: 20px 30px 0 30px;
            background: white;
            border-bottom: 2px solid var(--border-color);
            overflow-x: auto;
        }
        .tab-btn {
            padding: 10px 16px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            color: #a0aec0;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .tab-btn:hover { color: #4a5568; background: #f7fafc; }
        .tab-btn.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Enhanced Components */
        .progress-bar {
            height: 8px;
            background: #2a2a2a;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            border-radius: 4px;
            transition: width 0.6s ease;
        }

        .percentile-ladder {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 12px;
        }
        .percentile-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #1a1a1a;
            border-radius: 6px;
            border-left: 3px solid #333333;
        }
        .percentile-row.highlight { background: #1a2533; border-left-color: var(--accent-blue); font-weight: 700; }
        .percentile-label { color: #808080; font-size: 11px; text-transform: uppercase; font-weight: 700; }
        .percentile-value { color: #ffffff; font-weight: 700; font-feature-settings: "tnum"; }

        .geo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
        }
        .geo-item {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        .geo-city { font-size: 11px; color: #808080; margin-bottom: 4px; }
        .geo-salary { font-size: 14px; font-weight: 700; color: #ffffff; }
        .geo-delta { font-size: 10px; font-weight: 600; margin-top: 2px; }

        .task-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .task-name { flex: 0 0 120px; font-size: 11px; font-weight: 600; color: #a0a0a0; }
        .task-progress-bar {
            flex: 1;
            height: 20px;
            background: #1a1a1a;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        .task-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f59e0b);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 6px;
            font-size: 10px;
            font-weight: 800;
            color: white;
        }
        .task-desc { font-size: 10px; color: #707070; font-style: italic; margin-top: 2px; }

        .transition-card {
            background: #0f1a0f;
            border: 1px solid #1a3a1a;
            border-left: 3px solid var(--accent-green);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        .transition-title { font-size: 12px; font-weight: 700; color: #10b981; }
        .transition-meta { font-size: 10px; color: #6ee7b7; margin-top: 4px; }

        .risk-gauge {
            text-align: center;
            padding: 20px;
        }
        .risk-score {
            font-size: 48px;
            font-weight: 800;
            color: #ffffff;
            line-height: 1;
        }
        .risk-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #a0a0a0;
            font-weight: 700;
            margin-top: 8px;
        }
        .risk-bar-container {
            width: 100%;
            height: 12px;
            background: linear-gradient(90deg, #10b981, #fbbf24, #ef4444);
            border-radius: 6px;
            position: relative;
            margin-top: 12px;
        }
        .risk-indicator {
            position: absolute;
            width: 4px;
            height: 20px;
            background: #1e293b;
            top: -4px;
            border-radius: 2px;
        }

        .scenario-box {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid;
        }
        .scenario-box.best { background: #0f1a0f; border-color: #22c55e; }
        .scenario-box.worst { background: #1a0f0f; border-color: #ef4444; }
        .scenario-box.likely { background: #0f1520; border-color: #3b82f6; }
        .scenario-title { font-size: 11px; font-weight: 800; text-transform: uppercase; margin-bottom: 6px; color: #ffffff; }
        .scenario-text { font-size: 12px; line-height: 1.5; color: #d0d0d0; }

        .case-study {
            background: #1a1a0f;
            border: 1px solid #3a3a1a;
            border-left: 3px solid #eab308;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 12px;
            line-height: 1.5;
            color: #fde047;
        }

        /* Empty State */
        #inspector-empty {
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #cbd5e0;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            padding: 40px;
        }

        /* --- D3 Interaction --- */
        .node circle { 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); 
            stroke: #fff; 
            stroke-width: 2px; 
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        .node:hover circle { stroke: #2d3748; stroke-width: 3px; transform: scale(1.2); }
        .node.selected circle { 
            stroke: #2d3748; 
            stroke-width: 6px; 
            fill: #fff !important; 
            stroke-dasharray: 4,2; 
            transform: scale(1.3);
        }
        
        .link { fill: none; stroke-linecap: round; opacity: 0.3; transition: all 0.4s; }
        .link.highlight { opacity: 0.8; }
        .link.dim { opacity: 0.3; }
        .node.dim { opacity: 0.7; }

        .label-main { font-weight: 700; font-size: 12px; fill: #ffffff; text-shadow: 0 1px 0 #000, 0 -1px 0 #000, 1px 0 0 #000, -1px 0 0 #000; pointer-events: none;}
        .label-sub { font-size: 10px; fill: #a0a0a0; pointer-events: none;}

        /* Scrollbar polish */
        ::-webkit-scrollbar { width: 3px; height: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333333; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #444444; }

        /* Mobile Responsive Layout */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            #viz-panel {
                height: 45vh;
                min-height: 300px;
            }

            #header {
                padding: 12px 16px;
            }

            .header-content h1 {
                font-size: 16px;
            }

            .header-content .subtitle {
                font-size: 11px;
            }

            #legend {
                display: none; /* Hide legend on mobile to save space */
            }

            #inspector-panel {
                width: 100%;
                height: 55vh;
                border-left: none;
                border-top: 2px solid var(--border-color);
                box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
            }

            .inspector-inner {
                padding: 20px;
            }

            .role-title {
                font-size: 20px;
            }

            #inspector-empty {
                height: auto;
                min-height: 200px;
                padding: 20px;
            }
        }

        /* Very small mobile devices */
        @media (max-width: 480px) {
            #viz-panel {
                height: 40vh;
            }

            #inspector-panel {
                height: 60vh;
            }

            .header-content h1 {
                font-size: 14px;
            }

            .role-title {
                font-size: 18px;
            }

            .inspector-inner {
                padding: 16px;
                gap: 16px;
            }
        }

    </style>
</head>
<body>

    <div id="viz-panel">
        <div id="header">
            <div class="header-content">
                <h1>Job Distribution and AI Impact Analysis</h1>
                <p class="subtitle">2026 to 2036</p>
            </div>
        </div>
        <div id="chart-container"></div>
    </div>

    <div id="inspector-panel">
        <div id="inspector-empty">
            <div style="font-size: 40px; margin-bottom: 10px;">ðŸ“Š</div>
            Select a population node<br>to inspect 3-dimensional data.
        </div>
        <div id="inspector-content" style="display:none;">
            <!-- Content injected via JS -->
        </div>
    </div>

    <script>
        // ==========================================
        // 1. THE DATA ENGINE (High Fidelity)
        // ==========================================
        const rawData = {
            name: "US Population (~340.1M)",
            value: 340.1,
            category: "root",
            children: [
                {
                    name: "A. Under Age 16",
                    value: 63.0,
                    category: "A",
                    children: [
                        {
                            name: "Pre-School (0-4)",
                            value: 18.4,
                            category: "A",
                            financial: { mean: 0, sigma: 0, nuance: "Imputed Replacement Cost: ~$14.65/hr (Childcare Wage)." },
                            ai: {
                                mech: "AI Impact via monitoring and automated educational toys.",
                                t2: "0%", t5: "0%", t10: "Low",
                                paradox: null
                            },
                            age: { mean: 2.5, sigma: 1.4, bracket: "0-4", nuance: "Strict biological gate. 100% of cohort is under 5." }
                        },
                        {
                            name: "School-Age (5-15)",
                            value: 41.2,
                            category: "A",
                            financial: { mean: 0, sigma: 0, nuance: "Human Capital Formation phase. Zero earned income." },
                            ai: {
                                mech: "Decoupling of Learning: AI tutoring adapts pace perfectly, but AI writing tools threaten assessment integrity.",
                                t2: "0%", t5: "-5%", t10: "Chaos",
                                paradox: { title: "The Assessment Crisis", text: "If AI does the homework, how do we measure learning? Schools may revert to oral exams." }
                            },
                            age: { mean: 10.0, sigma: 2.8, bracket: "5-15", nuance: "Compulsory education window." }
                        },
                        {
                            name: "Teens (15)",
                            value: 3.4,
                            category: "A",
                            financial: { mean: 2500, sigma: 1500, p10: 0, p90: 15000, nuance: "Income zero-inflated. Concentrated in Food/Sales/Gig work." },
                            ai: { mech: "Entry-level jobs held by teens are highest risk for kiosk/robot automation.", t2: "-5%", t5: "-15%", t10: "-30%", paradox: null },
                            age: { mean: 15.5, sigma: 0.5, bracket: "15-16", nuance: "Transitional cohort entering labor force." }
                        }
                    ]
                },
                {
                    name: "B. Inst/Military",
                    value: 7.6,
                    category: "B",
                    children: [
                        {
                            name: "Active Duty Military",
                            value: 1.3,
                            category: "B",
                            financial: { mean: 42500, sigma: 4200, p10: 22380, p90: 60000, nuance: "Includes housing/food allowances." },
                            ai: { mech: "Autonomous Systems: Drone swarms and cyber-warfare replace frontline infantry.", t2: "0%", t5: "-2%", t10: "-10%", paradox: null },
                            age: { mean: 28.5, sigma: 5.8, bracket: "18-30", nuance: "Engineered Youth. 'Up or out' system truncates at 40. Enlisted Î¼ â‰ˆ 23." }
                        },
                        {
                            name: "Correctional Facilities",
                            value: 2.0,
                            category: "B",
                            financial: { mean: 0, sigma: 0, nuance: "State dependent cost." },
                            ai: { mech: "Predictive Justice: Risk assessment algorithms. Automated surveillance.", t2: "0%", t5: "0%", t10: "+2%", paradox: null },
                            age: { mean: 38.2, sigma: 11.5, bracket: "25-54", nuance: "The Missing Men. Prime-age males removed from labor force." }
                        },
                        {
                            name: "Nursing Homes",
                            value: 4.3,
                            category: "B",
                            financial: { mean: 0, sigma: 0, nuance: "High cost center." },
                            ai: { mech: "Safety Monitoring: Computer vision for fall detection.", t2: "0%", t5: "+5%", t10: "+10%", paradox: null },
                            age: { mean: 81.4, sigma: 9.3, bracket: "80+", nuance: "The End of the Line. Heavy right skew (Centenarians)." }
                        }
                    ]
                },
                {
                    name: "C. Employed",
                    value: 158.7,
                    category: "C",
                    children: [
                        {
                            name: "Mgmt & Prof.",
                            value: 70.7,
                            category: "C",
                            children: [
                                {
                                    name: "Executives (CEOs)",
                                    value: 10.2, 
                                    category: "C",
                                    financial: { mean: 258900, sigma: 100000, p10: 80000, p90: 500000, nuance: "Pareto Distribution. Capped reporting. Long tail into millions." },
                                    ai: {
                                        mech: "Decision Support: AI acts as 'Super-Analyst'. Accountability cannot be automated.",
                                        t2: "0%", t5: "-2%", t10: "Stable",
                                        paradox: { title: "The Accountability Wall", text: "AI can make the decision, but humans must serve the jail time if it's wrong." }
                                    },
                                    age: { mean: 48.1, sigma: 11.5, bracket: "45-64", nuance: "Quintessential Senior Node. Absence of youth is near absolute." }
                                },
                                {
                                    name: "Accountants",
                                    value: 1.4,
                                    category: "C",
                                    financial: { mean: 86000, sigma: 25000, p10: 50000, p90: 130000, nuance: "CPA certification adds premium. Public vs private accounting wage gap." },
                                    ai: {
                                        mech: "Automated Analysis: LLMs excel at anomaly detection and reconciling ledgers.",
                                        mechDetail: "AI systems can automatically reconcile financial statements, detect anomalies in transactions, classify expenses, and generate preliminary audit reports. The 'grunt work' of accounting - data entry, categorization, basic reconciliation - is perfectly suited for automation. However, complex judgment calls about accounting treatments, tax strategy, and forensic investigation require human expertise. The profession is shifting from 'bookkeeping' to 'financial advisory' as routine tasks are automated.",
                                        t2: "0%", t5: "-5%", t10: "Testing",
                                        paradox: { title: "Audit Efficiency", text: "Fewer accountants needed for entry-level work creates a shortage of experienced senior partners in 10 years." }
                                    },
                                    age: { mean: 44.0, sigma: 12.0, bracket: "30-55", nuance: "Mid-career plateau. CPA exam passage at ~25 creates entry delay." }
                                },
                                {
                                    name: "HR & Compliance",
                                    value: 0.8,
                                    category: "C",
                                    financial: { mean: 75000, sigma: 20000, p10: 45000, p90: 110000, nuance: "Corporate overhead function. CHRO positions command premium." },
                                    ai: {
                                        mech: "Algorithmic Management: Automated screening, onboarding. Bias laws create need for human auditors.",
                                        mechDetail: "AI recruiting tools screen resumes, schedule interviews, and predict candidate fit. Onboarding workflows are automated. Benefits administration uses chatbots. However, algorithmic bias regulations require human oversight to audit AI decisions. The role bifurcates: low-level admin disappears while high-level 'People Analytics' and compliance roles grow. The paradox is that we need humans to audit the AI we built to replace humans.",
                                        t2: "-1%", t5: "-8%", t10: "Contraction",
                                        paradox: { title: "The Bias Loop", text: "To prevent AI bias, we hire humans to audit the AI, whose data is then used to retrain the AI." }
                                    },
                                    age: { mean: 42.0, sigma: 10.0, bracket: "30-50", nuance: "Female-skewed demographic. High representation in corporate DEI roles." }
                                },
                                {
                                    name: "Software Developers",
                                    value: 5.4, 
                                    category: "C",
                                    financial: { 
                                        mean: 132000, sigma: 38000, 
                                        nuance: "Driven by geography (Bay Area) and specialization (AI/ML vs Web).",
                                        percentiles: { p10: 65000, p25: 95000, p50: 120000, p75: 165000, p90: 195000 },
                                        geographic: { bayArea: 185000, nyc: 155000, austin: 125000, rural: 85000 },
                                        compensation: { base: 110000, bonus: 15000, stock: 5000, benefits: 2000 },
                                        purchasingPower: { bayArea: 92500, nyc: 103000, austin: 118000, rural: 148000 },
                                        trajectory: { year1: 70000, year5: 100000, year10: 140000, year20: 180000 },
                                        volatility: "low"
                                    },
                                    ai: {
                                        mech: "Hyper-Augmentation: Coding assistants (Copilot) increase productivity 30-50%.",
                                        mechDetail: "Large Language Models (LLMs) and code generation tools like GitHub Copilot, Cursor, and Claude have fundamentally transformed software development. These tools autocomplete entire functions, generate boilerplate code, explain complex codebases, and even debug errors in real-time. Studies show 30-50% productivity gains for routine tasks. However, the job is shifting from 'writing code' to 'architecting systems' - defining what to build, validating AI output, and ensuring system integrity. The barrier to entry drops as natural language becomes the new programming syntax, but the ceiling rises as system complexity explodes.",
                                        t2: "+2%", t5: "+5%", t10: "Boom?",
                                        confidenceIntervals: { t2: {mean: 2, low: -5, high: 8}, t5: {mean: 5, low: -10, high: 15}, t10: {mean: 10, low: -15, high: 30} },
                                        taskDecomposition: [
                                            {task: "Code Generation", automatable: 70, desc: "Boilerplate, CRUD, basic algorithms"},
                                            {task: "Architecture Design", automatable: 20, desc: "System design, scalability decisions"},
                                            {task: "Debugging", automatable: 50, desc: "AI finds bugs, humans fix complex logic"},
                                            {task: "Code Review", automatable: 40, desc: "AI flags issues, humans assess context"}
                                        ],
                                        transitionPaths: [
                                            {to: "Systems Architect", difficulty: "medium", timeframe: "2-3 years"},
                                            {to: "Product Manager", difficulty: "high", timeframe: "3-5 years"},
                                            {to: "AI/ML Engineer", difficulty: "medium", timeframe: "1-2 years"}
                                        ],
                                        historicalAnalogy: "Like CAD for engineers in the 1980s - dramatically increased productivity without eliminating the profession. Engineers didn't disappear; they designed more complex systems.",
                                        paradox: { 
                                            title: "Jevons vs. Substitution", 
                                            text: "Does cheaper coding mean we build 10x more software (Jevons Paradox) or do we fire 50% of devs (Labor Substitution)? History suggests Jevons wins - when costs drop, demand explodes. Every company becomes a software company." 
                                        }
                                    },
                                    age: { 
                                        mean: 42.5, sigma: 9.0, bracket: "35-54", 
                                        nuance: "Matured Tech Sector. 'Boy genius' is a minority. Seasoned managers dominate.",
                                        cohorts: { "20s": 15, "30s": 35, "40s": 30, "50s": 18, "60+": 2 },
                                        generations: { genZ: 8, millennial: 45, genX: 35, boomer: 12 },
                                        retirementCliff: 2038,
                                        experiencePremium: { entry: 65000, mid: 132000, senior: 195000 }
                                    },
                                    laborMarket: {
                                        supplyDemand: { openings: 500000, workers: 5400000, ratio: 0.09, trend: "growing" },
                                        entryBarriers: { educationYears: 4, certificationCost: 5000, timeToCompetency: 2 },
                                        turnover: 0.15,
                                        growth: { historic: 0.08, projected: 0.10 },
                                        unionDensity: 0.02
                                    },
                                    risk: {
                                        automationRiskScore: 45,
                                        economicSensitivity: "medium",
                                        skillTransferability: "high",
                                        physicalConstraint: "none",
                                        regulatoryMoat: "low"
                                    },
                                    comparative: {
                                        similarRoles: [
                                            {name: "Systems Architect", salary: 145000, aiImpact: "+8%"},
                                            {name: "Data Engineer", salary: 128000, aiImpact: "+10%"},
                                            {name: "DevOps Engineer", salary: 135000, aiImpact: "+3%"}
                                        ],
                                        nationalBenchmark: { vsMedianIncome: 2.1, vsMedianCollege: 1.5 },
                                        historicalPurchasing: { year1980: 45000, year2000: 75000, year2024: 132000 }
                                    },
                                    hidden: {
                                        benefitsValue: 22000,
                                        workLifeMetrics: { avgHoursPerWeek: 45, stressIndex: 6.5, burnoutRate: 0.18, remoteEligibility: 0.85 },
                                        satisfactionIndex: 7.2
                                    },
                                    narratives: {
                                        caseStudies: [
                                            "Maria, 34, switched from manual QA to AI-assisted development. Uses Copilot to write test suites 5x faster, freeing time for architecture work.",
                                            "John, 52, senior developer competing with younger talent. AI levels the playing field - his experience in system design becomes more valuable than raw coding speed."
                                        ],
                                        policyImplications: "Universal Basic Income would reduce pressure to accept low wages in boom-bust tech cycles, enabling workers to retrain during downturns without financial ruin.",
                                        scenarios: {
                                            best: "AI boom creates 2M new tech jobs by 2036 as software becomes virtually free to produce, leading to explosion in digital products.",
                                            worst: "50% displacement as fully autonomous AI agents write, test, and deploy code without human intervention.",
                                            likely: "Net +10% growth as augmentation wins. Junior roles disappear but senior architecture roles expand dramatically."
                                        }
                                    }
                                },
                                {
                                    name: "Engineers (Arch/Eng)",
                                    value: 3.6,
                                    category: "C",
                                    financial: { mean: 99090, sigma: 32900, p10: 51130, p90: 159630, nuance: "Civil: Î¼ $98k. Petroleum: Î¼ $145k." },
                                    ai: {
                                        mech: "Generative Design: AI generates optimized options from constraints.",
                                        t2: "+1%", t5: "+3%", t10: "Gradual",
                                        paradox: null
                                    },
                                    age: { mean: 43.0, sigma: 12.0, bracket: "30-50", nuance: "Requires degree + licensure period." }
                                },
                                {
                                    name: "Scientists",
                                    value: 1.9,
                                    category: "C",
                                    financial: { mean: 87870, sigma: 29300, p10: 43680, p90: 140280, nuance: "Biotech/Med Sci: Î¼ $105k. PhD premium evident in long tail." },
                                    ai: {
                                        mech: "Acceleration: AI compresses the scientific method (Hypothesis â†’ Analysis). AlphaFold disruption.",
                                        mechDetail: "AI tools like AlphaFold have revolutionized protein structure prediction, compressing decades of experimental work into hours. Machine learning accelerates drug discovery, materials science, and climate modeling by generating hypotheses, simulating experiments, and analyzing massive datasets at superhuman speeds. However, the bottleneck shifts from 'discovery' to 'validation' - real-world experiments, clinical trials, and peer review cannot be automated. Scientists become 'data orchestrators' who design experiments and validate AI-generated insights rather than manually processing results.",
                                        t2: "+2%", t5: "+5%", t10: "Boom",
                                        paradox: { title: "Discovery vs Validation", text: "AI accelerates discovery, shifting the bottleneck to 'real-world validation' (clinical trials, lab work)." }
                                    },
                                    age: { mean: 44.0, sigma: 11.0, bracket: "30-60", nuance: "PhD requirements push entry age. Long careers typical due to knowledge accumulation." }
                                },
                                {
                                    name: "Physicians",
                                    value: 2.0,
                                    category: "C",
                                    financial: { mean: 230000, sigma: 60000, p10: 150000, p90: 450000, nuance: "Extreme variance by specialty. Primary Care ~$220k; Specialists (Cardio, Ortho) >$400k." },
                                    ai: {
                                        mech: "Augmentation (Iron Dome): AI handles diagnostics/paperwork; Humans do ethics/empathy.",
                                        mechDetail: "AI diagnostic tools (radiology, pathology) achieve superhuman accuracy, while AI scribes eliminate clinical documentation burden that causes burnout. However, the 'Iron Dome' protects physicians: complex ethical decisions (end-of-life care, treatment trade-offs), nuanced patient communication, and legal liability cannot be automated. AI increases physician productivity by removing administrative overhead, paradoxically increasing demand for human doctors as they can see more patients and detect more conditions requiring treatment.",
                                        t2: "+3%", t5: "+8%", t10: "Shortage",
                                        paradox: { title: "Diagnostic Abundance", text: "AI finds *more* diseases earlier, increasing the demand for treatment (and doctors)." }
                                    },
                                    age: { mean: 51.0, sigma: 10.0, bracket: "35-65", nuance: "Late entry due to 4yr undergrad + 4yr med + 3-7yr residency. Careers extend into 60s." }
                                },
                                {
                                    name: "Nurses",
                                    value: 3.2,
                                    category: "C",
                                    financial: { mean: 86000, sigma: 18000, p10: 55000, p90: 120000, nuance: "Overtime/Travel nursing spikes income. Night differential adds 10-20%." },
                                    ai: {
                                        mech: "Robotic Lag: Moravec's Paradox (hard to automate physical care/dexterity).",
                                        mechDetail: "Moravec's Paradox states: computationally, it is easier to teach a computer to diagnose cancer (pattern recognition) than to change a bedpan (physical dexterity in unstructured environments). Nursing is fundamentally a 'hands-on' profession requiring physical strength, fine motor control, and rapid adaptation to chaotic hospital environments. AI handles charting and medication cross-checking, but cannot perform IV insertion, wound care, patient repositioning, or the dozens of physical tasks that define nursing. Demographic aging drives explosive demand.",
                                        t2: "+5%", t5: "+12%", t10: "Shortage",
                                        paradox: { title: "Moravec's Paradox", text: "It is computationally easier to diagnose cancer (math) than to change a bedpan (dexterity)." }
                                    },
                                    age: { mean: 43.0, sigma: 12.0, bracket: "25-55", nuance: "Physically demanding work creates early retirement pressure. 12-hour shifts accelerate burnout." }
                                },
                                {
                                    name: "Arts & Media",
                                    value: 3.5,
                                    category: "C",
                                    financial: { mean: 76500, sigma: 30100, p10: 30410, p90: 129670, nuance: "Skewed by top 10% talent. Median ($58k) more representative than mean." },
                                    ai: {
                                        mech: "Generative Disruption: Models commoditize 'average' output. 'Human Premium' for connection.",
                                        mechDetail: "Generative AI (Midjourney, GPT-4, Sora) has commoditized 'average' creative output - stock imagery, basic copywriting, and commercial illustration are now produced at near-zero marginal cost. This collapses the market for mid-tier freelancers. However, 'premium' human creativity - authentic storytelling, live performance, cultural commentary - gains value through scarcity. The 'Human Premium' emerges: as synthetic content floods the market, audiences pay more for verifiable human creation. Artists pivot from 'makers' to 'curators' and 'creative directors' who guide AI tools.",
                                        t2: "-2%", t5: "-8%", t10: "Strikes",
                                        paradox: { title: "Content Inflation", text: "As cost of content drops to zero, the value of *filtering* and *curation* skyrockets." }
                                    },
                                    age: { mean: 39.0, sigma: 13.0, bracket: "25-45", nuance: "Youth-skewed entry (barriers low), but long tail for established names. Bimodal distribution." }
                                },
                                {
                                    name: "Social Service",
                                    value: 2.9,
                                    category: "C",
                                    financial: { mean: 55000, sigma: 12000, p10: 35000, p90: 80000, nuance: "Govt/Non-Profit wage scales compress variance. Master's degree (MSW) provides modest premium." },
                                    ai: {
                                        mech: "Empathy Defense: Edge cases (crisis, grief) require human connection.",
                                        mechDetail: "Social work operates at the edges of human experience where algorithmic systems catastrophically fail: suicide intervention, child abuse assessment, grief counseling, domestic violence mediation. These scenarios require deep contextual understanding, emotional intelligence, and split-second ethical judgment that AI cannot replicate. AI may automate case management paperwork and benefits eligibility screening, freeing social workers to spend more time on direct human interaction. As technological alienation increases, demand for authentic human connection in mental health and crisis services rises.",
                                        t2: "+1%", t5: "+5%", t10: "Steady",
                                        paradox: { title: "Human Premium", text: "As digital interaction becomes cheap/fake, authentic human empathy becomes a luxury good." }
                                    },
                                    age: { mean: 42.0, sigma: 12.0, bracket: "30-55", nuance: "High burnout rates affect retention. Vicarious trauma common. Peak productivity 35-50." }
                                },
                                {
                                    name: "Legal (Lawyers)",
                                    value: 1.2,
                                    category: "C",
                                    financial: { mean: 163000, sigma: 68000, p10: 62190, p90: 250000, nuance: "Bimodal: Public Def vs Big Law." },
                                    ai: {
                                        mech: "Augmentation: AI handles research/review. Courtroom requires human judgment.",
                                        t2: "0%", t5: "-2%", t10: "Slow",
                                        paradox: { title: "Hallucination Barrier", text: "Liability concerns prevent rapid adoption. A lawyer citing a fake AI case gets disbarred." }
                                    },
                                    age: { mean: 47.5, sigma: 11.0, bracket: "40-60", nuance: "High educational barrier pushes entry age to late 20s." }
                                },
                                {
                                    name: "Paralegals",
                                    value: 0.7,
                                    category: "C",
                                    financial: { mean: 59000, sigma: 12000, p10: 38000, p90: 85000, nuance: "Hourly billing structures under threat. Certificate vs degree splits wage distribution." },
                                    ai: {
                                        mech: "Displacement: Core tasks (summarizing, organizing, drafting) are 'Hello World' for LLMs.",
                                        mechDetail: "Unlike lawyers, paralegals perform the exact text-processing tasks that LLMs excel at: summarizing depositions, organizing evidence databases, drafting standard motions, and conducting legal research. These are the 'grunt work' tasks that represent 70-80% of paralegal time. AI can now complete these tasks in seconds rather than hours. The billable hour model collapses. While lawyers are protected by courtroom requirements and liability, paralegals have no such moat. The role transforms from 'legal assistant' to 'legal data specialist' requiring far fewer people.",
                                        t2: "-5%", t5: "-15%", t10: "Freeze",
                                        paradox: { title: "Perfect Substitution", text: "Unlike lawyers, paralegals perform the exact text-processing tasks LLMs excel at." }
                                    },
                                    age: { mean: 39.5, sigma: 11.0, bracket: "25-50", nuance: "Younger demographic than lawyers. Associates degree entry point vs JD requirement." }
                                },
                                {
                                    name: "Education Admin",
                                    value: 9.6,
                                    category: "C",
                                    financial: { mean: 64500, sigma: 22900, p10: 30670, p90: 106130, nuance: "Professors: Î¼ $95k." },
                                    ai: {
                                        mech: "Transformation: 'Lecturer' obsolete; 'Facilitator' essential.",
                                        t2: "0%", t5: "-2%", t10: "Burnout",
                                        paradox: null
                                    },
                                    age: { mean: 46.2, sigma: 10.5, bracket: "45+", nuance: "Top-Heavy. Requires tenure (teaching first). Looming retirement wave." }
                                },
                                {
                                    name: "General & Operations Mgrs",
                                    value: 2.5,
                                    category: "C",
                                    financial: { mean: 129330, sigma: 65500, p10: 55000, p90: 185000, nuance: "Title applied to both small retail supervisors (lower tail) and VP-level operatives (upper tail)." },
                                    ai: {
                                        mech: "Span of Control: AI handles logistics, allowing managers to oversee larger teams.",
                                        t2: "0%", t5: "-2%", t10: "-5%",
                                        paradox: null
                                    },
                                    age: { mean: 44.0, sigma: 12.0, bracket: "35-54", nuance: "Broad title covering supervisors to senior directors." }
                                },
                                {
                                    name: "Computer & IS Managers",
                                    value: 0.5,
                                    category: "C",
                                    financial: { mean: 169894, sigma: 48200, p10: 95000, p90: 230000, nuance: "High floor, high ceiling. Even 10th percentile earns significantly above national median." },
                                    ai: {
                                        mech: "Technical Leadership: AI automates infrastructure management but increases system complexity.",
                                        t2: "+1%", t5: "+2%", t10: "+3%",
                                        paradox: null
                                    },
                                    age: { mean: 43.5, sigma: 10.0, bracket: "35-54", nuance: "Requires technical experience before moving into management." }
                                },
                                {
                                    name: "Financial Managers",
                                    value: 1.5,
                                    category: "C",
                                    financial: { mean: 156100, sigma: 55000, p10: 70000, p90: 200000, nuance: "10th percentile is $45,480, while 90th is $140,490. Wide spread suggests bifurcation." },
                                    ai: {
                                        mech: "Strategic Finance: AI handles analysis and forecasting; humans make capital allocation decisions.",
                                        t2: "0%", t5: "-3%", t10: "-5%",
                                        paradox: null
                                    },
                                    age: { mean: 45.5, sigma: 11.0, bracket: "35-54", nuance: "Requires CPA/CFA credentials and years of experience." }
                                },
                                {
                                    name: "Market Research Analysts",
                                    value: 0.8,
                                    category: "C",
                                    financial: { mean: 87870, sigma: 34400, p10: 40000, p90: 130000, nuance: "Wide variation based on industry (tech vs retail) and seniority." },
                                    ai: {
                                        mech: "Data Synthesis: AI scrapes and analyzes consumer data; humans interpret strategic implications.",
                                        t2: "0%", t5: "-5%", t10: "-10%",
                                        paradox: { title: "Survey Collapse", text: "As AI predicts consumer behavior, traditional surveys become obsolete." }
                                    },
                                    age: { mean: 38.0, sigma: 11.0, bracket: "25-44", nuance: "Entry-level heavy with senior specialists." }
                                },
                                {
                                    name: "Other Business Operations",
                                    value: 13.4,
                                    category: "C",
                                    financial: { mean: 85000, sigma: 28000, p10: 45000, p90: 125000, nuance: "Catchall for business analysts, consultants, project managers, and operations specialists." },
                                    ai: {
                                        mech: "Process Automation: Workflow automation and AI project management tools reduce coordination roles.",
                                        t2: "-1%", t5: "-8%", t10: "-15%",
                                        paradox: null
                                    },
                                    age: { mean: 41.0, sigma: 12.5, bracket: "30-50", nuance: "Diverse group spanning entry-level analysts to senior strategists." }
                                },
                                {
                                    name: "Other Healthcare Practitioners",
                                    value: 3.0,
                                    category: "C",
                                    financial: { mean: 92000, sigma: 35000, p10: 50000, p90: 145000, nuance: "Includes pharmacists ($140k), physical therapists ($95k), dietitians ($65k), respiratory therapists ($70k)." },
                                    ai: {
                                        mech: "Clinical Support: AI assists with drug interaction checking and treatment protocols.",
                                        t2: "+2%", t5: "+5%", t10: "+8%",
                                        paradox: null
                                    },
                                    age: { mean: 42.0, sigma: 11.5, bracket: "30-55", nuance: "Requires graduate degrees (PharmD, DPT) pushing entry age to late 20s." }
                                },
                                {
                                    name: "Other Professional",
                                    value: 2.6,
                                    category: "C",
                                    financial: { mean: 78000, sigma: 30000, p10: 42000, p90: 120000, nuance: "Miscellaneous professional occupations including librarians, archivists, curators, and technicians." },
                                    ai: {
                                        mech: "Mixed Impact: Some roles (archivists) benefit from AI cataloging; others face automation pressure.",
                                        t2: "0%", t5: "-3%", t10: "-5%",
                                        paradox: null
                                    },
                                    age: { mean: 43.0, sigma: 13.0, bracket: "30-55", nuance: "Diverse professional support roles across industries." }
                                }
                            ]
                        },
                        {
                            name: "Service Occs",
                            value: 28.5,
                            category: "C",
                            children: [
                                {
                                    name: "Food Prep",
                                    value: 8.1,
                                    category: "C",
                                    financial: { mean: 34490, sigma: 7600, p10: 22160, p90: 47390, nuance: "Highly compressed. Fast food (~$28k) vs Exec Chefs." },
                                    ai: {
                                        mech: "Kiosks & Robotics: Ordering automated; 'Flippy' robots for repetitive frying.",
                                        t2: "-1%", t5: "-5%", t10: "Attrition",
                                        paradox: null
                                    },
                                    age: { mean: 29.8, sigma: 10.4, bracket: "16-24", nuance: "Lowest Mean Age. Primary domain of the 'Frictional' workforce." }
                                },
                                {
                                    name: "Protective Service",
                                    value: 3.0,
                                    category: "C",
                                    financial: { mean: 57710, sigma: 21300, p10: 29890, p90: 100170, nuance: "Police (high/pension) vs Private Guards (low)." },
                                    ai: {
                                        mech: "Surveillance vs. Action: AI cameras replace static guards.",
                                        t2: "0%", t5: "-2%", t10: "Mixed",
                                        paradox: null
                                    },
                                    age: { mean: 40.5, sigma: 9.2, bracket: "25-54", nuance: "Prime-Age Male. Lacks the teenage spike and geriatric tail." }
                                },
                                {
                                    name: "Healthcare Support",
                                    value: 5.3,
                                    category: "C",
                                    financial: { mean: 38220, sigma: 7000, p10: 26800, p90: 49840, nuance: "Highly compressed wages. Home health aides and nursing assistants have little room for growth." },
                                    ai: {
                                        mech: "Physical Care: Moravec's Paradox protects these jobs. Cannot automate bedpan changes or patient lifting.",
                                        t2: "+3%", t5: "+8%", t10: "+15%",
                                        paradox: { title: "Care Shortage", text: "Aging demographics create insatiable demand that AI cannot meet." }
                                    },
                                    age: { mean: 41.0, sigma: 13.0, bracket: "25-55", nuance: "Physically demanding work with high burnout. Early exit common." }
                                },
                                {
                                    name: "Building & Grounds Cleaning",
                                    value: 4.8,
                                    category: "C",
                                    financial: { mean: 35900, sigma: 7900, p10: 23640, p90: 49630, nuance: "Janitors, landscapers, pest control. Low wages with minimal variance." },
                                    ai: {
                                        mech: "Partial Automation: Robotic floor cleaners for large open spaces. Complex cleaning remains manual.",
                                        t2: "0%", t5: "-2%", t10: "-5%",
                                        paradox: null
                                    },
                                    age: { mean: 42.0, sigma: 14.0, bracket: "25-55", nuance: "High immigrant workforce participation. Wide age spread." }
                                },
                                {
                                    name: "Personal Care & Service",
                                    value: 6.6,
                                    category: "C",
                                    financial: { mean: 38430, sigma: 10800, p10: 23130, p90: 58630, nuance: "Childcare workers ($31k), hairdressers ($35k), funeral directors ($60k). High variance." },
                                    ai: {
                                        mech: "Human Touch: Services requiring empathy and manual dexterity are AI-resistant.",
                                        t2: "+1%", t5: "+3%", t10: "+5%",
                                        paradox: null
                                    },
                                    age: { mean: 38.0, sigma: 13.5, bracket: "20-50", nuance: "Younger workers in childcare; older in funeral services. Bimodal distribution." }
                                },
                                {
                                    name: "Other Service",
                                    value: 1.7,
                                    category: "C",
                                    financial: { mean: 36000, sigma: 9000, p10: 24000, p90: 52000, nuance: "Miscellaneous service occupations including animal care, entertainment attendants, and personal services." },
                                    ai: {
                                        mech: "Mixed Automation: Some tasks automated (ticket sales), others remain human (pet grooming).",
                                        t2: "0%", t5: "-3%", t10: "-5%",
                                        paradox: null
                                    },
                                    age: { mean: 36.0, sigma: 14.0, bracket: "20-50", nuance: "Youth-heavy with high turnover." }
                                }
                            ]
                        },
                        {
                            name: "Sales & Office",
                            value: 29.5,
                            category: "C",
                            children: [
                                {
                                    name: "Retail Sales",
                                    value: 13.8,
                                    category: "C",
                                    financial: { mean: 53280, sigma: 21900, p10: 25790, p90: 98040, nuance: "Retail (~$30k) vs Tech/Wholesale (~$90k)." },
                                    ai: {
                                        mech: "Self-Service: 'Just Walk Out' (Computer Vision) eliminates checkout.",
                                        t2: "-2%", t5: "-8%", t10: "Reduct.",
                                        paradox: "Shadow Work: The labor of checkout is transferred from the paid employee to the unpaid customer."
                                    },
                                    age: { mean: 37.5, sigma: 14.8, bracket: "16-24", nuance: "Youth-Heavy. 16-24 cohort is ~27% of workforce. High turnover." }
                                },
                                {
                                    name: "Office Admin",
                                    value: 15.7,
                                    category: "C",
                                    financial: { mean: 47940, sigma: 12500, p10: 30240, p90: 71440, nuance: "Largest group in US. High AI automation risk." },
                                    ai: {
                                        mech: "Direct Substitution: LLMs/Voice Agents perform core retrieval/routing at zero cost.",
                                        t2: "-2%", t5: "-12%", t10: "Collapse",
                                        paradox: { title: "The Paperwork Cliff", text: "There is no infinite demand for paperwork. If AI does it, the job simply disappears." }
                                    },
                                    age: { mean: 49.1, sigma: 13.0, bracket: "50+", nuance: "'Sunset' Node. Demographic cliff: retiring cohort not being replaced." }
                                }
                            ]
                        },
                        {
                            name: "Blue Collar",
                            value: 35.2,
                            category: "C",
                            children: [
                                {
                                    name: "Farming, Fishing, & Forestry",
                                    value: 0.8,
                                    category: "C",
                                    financial: { mean: 39970, sigma: 8100, p10: 30010, p90: 56640, nuance: "Excludes farm managers. Low-wage, seasonally volatile labor pool." },
                                    ai: {
                                        mech: "Precision Agriculture: Autonomous tractors and drone monitoring. Harvesting delicate crops still manual.",
                                        t2: "0%", t5: "-2%", t10: "-5%",
                                        paradox: null
                                    },
                                    age: { mean: 43.0, sigma: 15.0, bracket: "25-55", nuance: "Aging workforce with limited youth replacement. High immigrant participation." }
                                },
                                {
                                    name: "Construction",
                                    value: 8.0,
                                    category: "C",
                                    financial: { mean: 61500, sigma: 18600, p10: 36380, p90: 97700, nuance: "Electricians/Plumbers: Î¼ $65k+." },
                                    ai: {
                                        mech: "Low Impact: Unstructured/chaotic sites prevent robotic adoption.",
                                        t2: "+2%", t5: "+4%", t10: "Growth",
                                        paradox: "Chaos Premium: The messier the environment, the safer the job."
                                    },
                                    age: { mean: 41.6, sigma: 13.1, bracket: "25-54", nuance: "Flat-Topped. Safety Floor (few <18) and Physical Ceiling (few >65)." }
                                },
                                {
                                    name: "Construction Mgrs",
                                    value: 0.5,
                                    category: "C",
                                    financial: { mean: 105000, sigma: 25000, p10: 65000, p90: 160000, nuance: "Premium for managing complexity. General contractors vs specialized supervisors." },
                                    ai: {
                                        mech: "Digital Twins: AI simulation aids planning. BIM (Building Information Modeling) optimization.",
                                        mechDetail: "AI-powered Building Information Modeling (BIM) and digital twin simulations allow construction managers to optimize scheduling, material logistics, and cost estimation before breaking ground. However, the on-site chaos of construction - weather delays, material shortages, labor conflicts, regulatory inspections - requires human judgment and crisis management. AI handles the planning; humans handle the execution and adaptation. The role represents the career progression path for skilled tradespeople who move 'off the tools' into management.",
                                        t2: "0%", t5: "+2%", t10: "Steady",
                                        paradox: null
                                    },
                                    age: { mean: 44.5, sigma: 10.0, bracket: "35-54", nuance: "Represents time to master trade and physical necessity of moving off 'the tools'." }
                                },
                                {
                                    name: "Transport (Logistics)",
                                    value: 11.2,
                                    category: "C",
                                    financial: { mean: 46500, sigma: 11600, p10: 29270, p90: 67510, nuance: "Pilots (High) vs Uber/Truckers (Low)." },
                                    ai: {
                                        mech: "High Risk: AVs (Level 4) and warehouse robotics.",
                                        t2: "+2%", t5: "0%", t10: "Risk",
                                        paradox: null
                                    },
                                    age: { mean: 36.1, sigma: 11.0, bracket: "20-34", nuance: "The Exception. Driven by e-commerce. Young, expanding node." }
                                },
                                {
                                    name: "Production (Factory)",
                                    value: 8.8,
                                    category: "C",
                                    financial: { mean: 47620, sigma: 12100, p10: 30550, p90: 70370, nuance: "Auto Mfg (~$55k) vs Slaughtering (~$35k)." },
                                    ai: {
                                        mech: "Mature Automation: 'Cobots' and vision inspection.",
                                        t2: "0%", t5: "-2%", t10: "Reshoring",
                                        paradox: null
                                    },
                                    age: { mean: 44.8, sigma: 13.9, bracket: "45-64", nuance: "Inverted Pyramid. 20-24 cohort is dangerously thin vs 45-64." }
                                },
                                {
                                    name: "Installation, Maintenance, & Repair",
                                    value: 5.4,
                                    category: "C",
                                    financial: { mean: 58920, sigma: 16700, p10: 34340, p90: 89380, nuance: "HVAC techs, auto mechanics, telecom installers. 'Middle class' skilled trades." },
                                    ai: {
                                        mech: "Predictive Maintenance: IoT sensors predict failures. AR glasses assist in complex repairs.",
                                        t2: "+1%", t5: "+3%", t10: "+3%",
                                        paradox: { title: "Deskilling Risk", text: "AR assistance allows less-skilled techs to perform complex repairs, potentially lowering wages." }
                                    },
                                    age: { mean: 42.0, sigma: 12.5, bracket: "30-55", nuance: "Requires trade certification or apprenticeship. Physical work limits career length." }
                                },
                                {
                                    name: "Other Blue Collar",
                                    value: 1.0,
                                    category: "C",
                                    financial: { mean: 48000, sigma: 14000, p10: 32000, p90: 68000, nuance: "Miscellaneous production, extraction, and material moving occupations." },
                                    ai: {
                                        mech: "Varied Impact: Dependent on specific task and environment complexity.",
                                        t2: "0%", t5: "-2%", t10: "-3%",
                                        paradox: null
                                    },
                                    age: { mean: 42.0, sigma: 13.0, bracket: "30-55", nuance: "Mixed occupational group with varying age profiles." }
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "D. Unemployed",
                    value: 7.6,
                    category: "D",
                    children: [
                        {
                            name: "Frictional (<5 wks)",
                            value: 5.6,
                            category: "D",
                            financial: { mean: 24335, sigma: 8000, p10: 12000, p90: 45000, nuance: "State Benefits vary." },
                            ai: { mech: "AI Matching: Algorithms optimize job finding.", t2: "Faster", t5: "Faster", t10: "UBI?", paradox: null },
                            age: { mean: 33.2, sigma: 14.1, bracket: "16-24", nuance: "The Churn of Youth. High velocity. Sign of fluidity, not distress." }
                        },
                        {
                            name: "Structural (27+ wks)",
                            value: 2.0,
                            category: "D",
                            financial: { mean: 0, sigma: 0, nuance: "Benefits exhausted." },
                            ai: { mech: "Skill Mismatch: Skills obsolete.", t2: "Growing", t5: "Growing", t10: "Permanent", paradox: null },
                            age: { mean: 43.8, sigma: 14.9, bracket: "45-64", nuance: "The Trap of Age. 'Job Losers' are older than 'Job Leavers'." }
                        }
                    ]
                },
                {
                    name: "E. NILF",
                    value: 103.2,
                    category: "E",
                    children: [
                        {
                            name: "Retirees",
                            value: 49.0,
                            category: "E",
                            financial: { mean: 22884, sigma: 7500, p10: 12948, p90: 42000, nuance: "Social Security only." },
                            ai: {
                                mech: "Extension: AI/AgeTech ('Aging in Place').",
                                t2: "0%", t5: "+2%", t10: "Active",
                                paradox: "Silver Economy: AI enables seniors to work longer."
                            },
                            age: { mean: 74.5, sigma: 8.2, bracket: "65+", nuance: "The Silver Reserve. Left-censored at 62. Homogenous experience." }
                        },
                        {
                            name: "Students",
                            value: 14.4,
                            category: "E",
                            financial: { mean: 0, sigma: 0, nuance: "Negative Income (Debt)." },
                            ai: { mech: "Skill Obsolescence.", t2: "Crisis", t5: "Pivot", t10: "Hybrid", paradox: null },
                            age: { mean: 20.4, sigma: 3.1, bracket: "16-24", nuance: "Strictly Gated. Lowest sigma. Drop-off feeds Frictional Unemployment." }
                        },
                        {
                            name: "Homemakers",
                            value: 22.0,
                            category: "E",
                            financial: { mean: 184820, sigma: 45000, nuance: "Imputed Value." },
                            ai: { mech: "Logistics Automation.", t2: "0%", t5: "-2%", t10: "Assist", paradox: null },
                            age: { mean: 38.4, sigma: 11.2, bracket: "25-44", nuance: "The Care Gap. Expanding Sigma due to 'Sandwich Generation' elder care." }
                        },
                        {
                            name: "Disabled",
                            value: 12.0,
                            category: "E",
                            financial: { mean: 18444, sigma: 5000, p10: 9600, p90: 45864, nuance: "SSDI." },
                            ai: null,
                            age: { mean: 56.8, sigma: 15.6, bracket: "50-64", nuance: "Pre-Retirement Holding Tank for those physically compromised." }
                        },
                        {
                            name: "Other / Discouraged",
                            value: 5.8,
                            category: "E",
                            financial: { mean: 0, sigma: 0, nuance: "Early retirees (<65), gap year individuals, discouraged workers, independently wealthy." },
                            ai: {
                                mech: "Opportunity Cost: As automation eliminates low-skill jobs, some exit labor force permanently.",
                                t2: "Growing", t5: "Growing", t10: "Permanent",
                                paradox: { title: "Voluntary Exit", text: "For some, not working becomes more rational than accepting low-wage jobs with high stress." }
                            },
                            age: { mean: 48.0, sigma: 16.0, bracket: "30-64", nuance: "Heterogeneous group including 'FIRE' retirees (30s-40s) and burned-out older workers (50s-60s)." }
                        }
                    ]
                }
            ]
        };

        const colorMap = {
            "root": "#2d3748",
            "A": "#3b82f6", "B": "#8b5cf6", "C": "#10b981", "D": "#f59e0b", "E": "#6b7280"
        };

        // ==========================================
        // 2. MATH UTILS (Distributions)
        // ==========================================
        function getLogNormalPoints(mean, stdDev, width, height) {
            if (!mean || mean <= 0 || !stdDev) return null;
            const varSq = Math.pow(stdDev, 2);
            const meanSq = Math.pow(mean, 2);
            const sigma = Math.sqrt(Math.log(1 + (varSq / meanSq)));
            const mu = Math.log(mean) - 0.5 * Math.pow(sigma, 2);
            const xMin = 0; const xMax = mean + 3.5 * stdDev; 
            const points = []; const step = (xMax - xMin) / 80;

            const pdf = (x) => {
                if (x <= 0) return 0;
                const coef = 1 / (x * sigma * Math.sqrt(2 * Math.PI));
                const expon = -Math.pow(Math.log(x) - mu, 2) / (2 * Math.pow(sigma, 2));
                return coef * Math.exp(expon);
            };

            for(let x = xMin; x <= xMax; x += step) {
                let val = (x === 0) ? 0 : pdf(x);
                points.push([x, val]);
            }
            const maxY = d3.max(points, p => p[1]);
            const pathData = points.map(p => {
                const xPx = (p[0] / xMax) * width;
                const yPx = height - (p[1] / maxY) * height * 0.9;
                return `${xPx},${yPx}`;
            });
            return {
                path: `M0,${height} L${pathData.join(" L")} L${width},${height} Z`,
                linePath: `M0,${height} L${pathData.join(" L")}`,
                xScale: (val) => (val / xMax) * width
            };
        }

        // Standard Normal for Age
        function getNormalPoints(mean, stdDev, width, height) {
            if (!mean || !stdDev) return null;
            const xMin = Math.max(0, mean - 3 * stdDev);
            const xMax = mean + 3 * stdDev;
            const points = [];
            const step = (xMax - xMin) / 80;

            const pdf = (x) => {
                const coef = 1 / (stdDev * Math.sqrt(2 * Math.PI));
                const expon = -Math.pow(x - mean, 2) / (2 * Math.pow(stdDev, 2));
                return coef * Math.exp(expon);
            };

            for(let x = xMin; x <= xMax; x += step) {
                points.push([x, pdf(x)]);
            }
            const maxY = d3.max(points, p => p[1]);
            const pathData = points.map(p => {
                const xPx = ((p[0] - xMin) / (xMax - xMin)) * width;
                const yPx = height - (p[1] / maxY) * height * 0.9;
                return `${xPx},${yPx}`;
            });

            return {
                path: `M0,${height} L${pathData.join(" L")} L${width},${height} Z`,
                linePath: `M0,${height} L${pathData.join(" L")}`,
                xScale: (val) => ((val - xMin) / (xMax - xMin)) * width,
                xMin, xMax
            };
        }

        const formatCurrency = d3.format("$,.0f");

        // ==========================================
        // AI IMPACT SCORING
        // ==========================================
        function getAIImpactScore(node) {
            if (!node.data.ai) return 0;
            const ai = node.data.ai;
            
            // Parse t10 (10-year forecast)
            const t10 = ai.t10.toLowerCase();
            
            // Strongly Negative (Red)
            if (t10.includes('collapse') || t10.includes('-30')) return -3;
            if (t10.includes('attrition') || t10.includes('-15')) return -2.5;
            if (t10.includes('reduct') || t10.includes('-12')) return -2.5;
            if (t10.includes('-10')) return -2;
            if (t10.includes('chaos') || t10.includes('crisis') || t10.includes('permanent')) return -2;
            if (t10.includes('-8') || t10.includes('-5')) return -1.5;
            if (t10.includes('burnout') || t10.includes('risk')) return -1;
            if (t10.includes('mixed') || t10.includes('slow') || t10.includes('-2')) return -0.5;
            
            // Neutral (Yellow)
            if (t10.includes('stable') || t10.includes('low') || t10.includes('0%')) return 0;
            if (t10.includes('assist') || t10.includes('hybrid') || t10.includes('ubi')) return 0;
            if (t10.includes('faster') && !t10.includes('+')) return 0.5;
            
            // Positive (Green)
            if (t10.includes('boom') || t10.includes('+10')) return 3;
            if (t10.includes('growth') || t10.includes('+4')) return 2;
            if (t10.includes('gradual') || t10.includes('+3')) return 1.5;
            if (t10.includes('active') || t10.includes('reshoring') || t10.includes('+2')) return 1;
            
            return 0; // Default neutral
        }

        // ==========================================
        // 3. D3 VIZ ENGINE
        // ==========================================
        function initChart() {
            const container = document.getElementById("chart-container");
            const width = container.clientWidth;
            const root = d3.hierarchy(rawData);
            
            const leafCount = root.leaves().length;
            const nodeSpacing = 50;
            const height = Math.max(container.clientHeight, leafCount * nodeSpacing + 100);
            const levels = 4; const layerWidth = 400; 
            const chartWidth = Math.max(width, levels * layerWidth + 200);

            d3.select("#chart-container").selectAll("*").remove();

            const svg = d3.select("#chart-container")
                .append("svg")
                .attr("width", chartWidth)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(200, 40)`);

            const tree = d3.tree().size([height - 80, chartWidth - 400]);
            const treeData = tree(root);

            const maxVal = root.data.value;
            const thickness = d3.scaleLinear().domain([0, maxVal]).range([15, 150]);

            const colorMap = {
                "root": "#ffffff",
                "A": "#3b82f6", "B": "#8b5cf6", "C": "#10b981", "D": "#f59e0b", "E": "#6b7280"
            };

            // AI Impact Color Scale: Red (negative) -> Yellow (neutral) -> Green (positive)
            const aiColorScale = d3.scaleLinear()
                .domain([-3, 0, 3])
                .range(["#ef4444", "#fbbf24", "#10b981"]);

            const links = svg.selectAll(".link")
                .data(treeData.links())
                .enter().append("path")
                .attr("class", "link")
                .attr("d", d3.linkHorizontal().x(d => d.y).y(d => d.x))
                .style("stroke", d => {
                    // For leaf nodes, use AI impact gradient
                    if (!d.target.children || d.target.children.length === 0) {
                        const aiScore = getAIImpactScore(d.target);
                        return aiColorScale(aiScore);
                    }
                    // For parent nodes, use category color
                    return colorMap[d.target.data.category] || "#888";
                })
                .style("stroke-width", d => thickness(d.target.data.value));

            const nodes = svg.selectAll(".node")
                .data(treeData.descendants())
                .enter().append("g")
                .attr("class", "node")
                .attr("id", d => "node-" + d.data.name.replace(/\s+/g, '').replace(/[^a-zA-Z]/g, ''))
                .attr("transform", d => `translate(${d.y},${d.x})`);

            nodes.append("circle")
                .attr("r", 6)
                .style("fill", d => colorMap[d.data.category] || "#888");

            // Title text with optional arrow for workforce leaf nodes
            nodes.append("text")
                .attr("dy", -10)
                .attr("x", d => d.children ? -10 : 10)
                .style("text-anchor", d => d.children ? "end" : "start")
                .attr("class", "label-main")
                .each(function(d) {
                    const isLeaf = !d.children || d.children.length === 0;
                    const isWorkforce = d.data.category === 'B' || d.data.category === 'C' || d.data.category === 'D';
                    const showArrow = isLeaf && isWorkforce;
                    
                    // Add name text
                    const text = d3.select(this);
                    text.text(d.data.name);
                    
                    // Add arrow if applicable
                    if (showArrow) {
                        const bbox = this.getBBox();
                        const aiScore = getAIImpactScore(d);
                        const arrowColor = aiColorScale(aiScore);
                        
                        // Choose arrow direction based on AI impact
                        let arrowSymbol = "â†’";
                        if (aiScore > 0.5) {
                            arrowSymbol = "â†‘"; // Positive impact
                        } else if (aiScore < -0.5) {
                            arrowSymbol = "â†“"; // Negative impact
                        }
                        
                        text.append("tspan")
                            .attr("dx", "8")
                            .style("font-size", "22px")
                            .style("fill", arrowColor)
                            .style("font-weight", "900")
                            .text(arrowSymbol);
                    }
                });

            nodes.append("text")
                .attr("dy", 12)
                .attr("x", d => d.children ? -10 : 10)
                .style("text-anchor", d => d.children ? "end" : "start")
                .text(d => d.data.value ? `${d.data.value}M` : "")
                .attr("class", "label-sub");

            // Add paradox name label (third line) for leaf nodes with paradoxes
            nodes.append("text")
                .attr("dy", 26)
                .attr("x", d => d.children ? -10 : 10)
                .style("text-anchor", d => d.children ? "end" : "start")
                .style("font-size", "9px")
                .style("fill", "#666666")
                .style("font-style", "italic")
                .style("pointer-events", "none")
                .text(d => {
                    const isLeaf = !d.children || d.children.length === 0;
                    if (isLeaf && d.data.ai && d.data.ai.paradox) {
                        if (typeof d.data.ai.paradox === 'string') {
                            return d.data.ai.paradox.substring(0, 30) + '...';
                        } else if (d.data.ai.paradox.title) {
                            return d.data.ai.paradox.title;
                        }
                    }
                    return "";
                });

            // --- INTERACTION ---
            nodes.on("click", (e, d) => {
                selectNode(d, d3.select(e.currentTarget));
            });
            
            svg.on("click", (e) => {
                if(e.target.tagName === 'svg') {
                    resetSelection();
                }
            });

            // Auto-Select "Software Developers" on load
            setTimeout(() => {
                const targetNode = nodes.filter(d => d.data.name === "Software Developers").node();
                if(targetNode) {
                    const d3Node = d3.select(targetNode);
                    selectNode(d3Node.datum(), d3Node);
                }
            }, 500);
        }

        function selectNode(d, element) {
            d3.selectAll(".node").classed("selected", false);
            element.classed("selected", true);
            const ancestors = new Set(d.ancestors());
            d3.selectAll(".node").classed("dim", n => !ancestors.has(n));
            d3.selectAll(".link").classed("dim", l => !ancestors.has(l.target));
            populateInspector(d);
        }

        // Aggregate data from all leaf descendants
        function aggregateDescendants(node) {
            const leaves = node.leaves();
            if (leaves.length === 0) return null;

            let totalPop = 0;
            let weightedAge = 0;
            let weightedIncome = 0;
            let hasFinancial = false;
            let hasAge = false;
            let ageMin = Infinity, ageMax = -Infinity;
            let incomeMin = Infinity, incomeMax = -Infinity;

            leaves.forEach(leaf => {
                const pop = leaf.data.value || 0;
                totalPop += pop;

                if (leaf.data.age && leaf.data.age.mean > 0) {
                    hasAge = true;
                    weightedAge += leaf.data.age.mean * pop;
                    const minAge = Math.max(0, leaf.data.age.mean - 3 * leaf.data.age.sigma);
                    const maxAge = leaf.data.age.mean + 3 * leaf.data.age.sigma;
                    ageMin = Math.min(ageMin, minAge);
                    ageMax = Math.max(ageMax, maxAge);
                }

                if (leaf.data.financial && leaf.data.financial.mean > 0) {
                    hasFinancial = true;
                    weightedIncome += leaf.data.financial.mean * pop;
                    incomeMin = Math.min(incomeMin, leaf.data.financial.mean - leaf.data.financial.sigma);
                    incomeMax = Math.max(incomeMax, leaf.data.financial.mean + leaf.data.financial.sigma);
                }
            });

            const result = {
                isAggregated: true,
                childCount: leaves.length,
                totalPopulation: totalPop
            };

            if (hasAge && totalPop > 0) {
                const avgAge = weightedAge / totalPop;
                const ageRange = ageMax - ageMin;
                result.age = {
                    mean: Math.round(avgAge * 10) / 10,
                    sigma: Math.round(ageRange / 6 * 10) / 10,
                    bracket: `${Math.round(ageMin)}-${Math.round(ageMax)}`,
                    nuance: `Aggregated from ${leaves.length} subcategories. Weighted average across ${totalPop.toFixed(1)}M people.`
                };
            }

            if (hasFinancial && totalPop > 0) {
                const avgIncome = weightedIncome / totalPop;
                const incomeRange = incomeMax - incomeMin;
                result.financial = {
                    mean: Math.round(avgIncome),
                    sigma: Math.round(incomeRange / 4),
                    nuance: `Aggregated from ${leaves.length} subcategories. Weighted average income across all roles.`
                };
            }

            return result;
        }

        function resetSelection() {
            d3.selectAll(".node").classed("selected", false).classed("dim", false);
            d3.selectAll(".link").classed("dim", false);
            document.getElementById("inspector-content").style.display = "none";
            document.getElementById("inspector-empty").style.display = "flex";
        }

        // ==========================================
        // 4. INSPECTOR PANEL LOGIC
        // ==========================================
        let currentTab = 'demographics';

        function switchTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === `tab-${tabName}`);
            });
        }

        function populateInspector(node) {
            const panel = document.getElementById("inspector-content");
            const empty = document.getElementById("inspector-empty");
            empty.style.display = "none";
            panel.style.display = "block";

            const isParent = node.children && node.children.length > 0;
            let displayData = node.data;
            
            if (isParent) {
                const aggregated = aggregateDescendants(node);
                if (aggregated) {
                    displayData = {...node.data, ...aggregated};
                }
            }

            // Single scrollable view - no tabs
            let html = `
                <div class="panel-header" style="padding: 20px 30px;">
                    <h2 class="role-title">${displayData.name}</h2>
                    <span class="role-meta">
                        <span class="meta-tag">POP: ${displayData.value}M</span>
                        <span class="meta-tag">CAT: ${displayData.category}</span>
                        ${displayData.isAggregated ? `<span class="meta-tag" style="background: #fed7aa; color: #9a3412;">AGGREGATED</span>` : ''}
                    </span>
                </div>
                <div class="inspector-inner">
            `;

            html += renderDemographicsTab(displayData);
            html += renderFinancialTab(displayData);
            html += renderAITab(displayData);
            html += renderLaborMarketTab(displayData);

            html += `</div>`;
            panel.innerHTML = html;
        }

        // === TAB RENDERERS ===
        function renderDemographicsTab(data) {
            if (!data.age || data.age.mean <= 0) return '';
            
            const age = data.age;
            const w = 400, h = 90;
            const graph = getNormalPoints(age.mean, age.sigma, w, h);
            let graphSVG = "";
            if (graph) {
                const xMean = graph.xScale(age.mean);
                graphSVG = `
                    <svg width="100%" height="100%" viewBox="0 0 ${w} ${h}">
                        <path d="${graph.path}" fill="rgba(245, 158, 11, 0.1)" stroke="none" />
                        <path d="${graph.linePath}" fill="none" stroke="#f59e0b" stroke-width="2" />
                        <line x1="${xMean}" y1="0" x2="${xMean}" y2="${h}" stroke="#f59e0b" stroke-width="1" stroke-dasharray="4,2"/>
                        <text x="${xMean+5}" y="15" fill="#f59e0b" font-size="10" font-weight="bold">Î¼ ${age.mean}</text>
                        <text x="5" y="${h-5}" fill="#a0a0a0" font-size="9">${Math.round(graph.xMin)}</text>
                        <text x="${w-20}" y="${h-5}" fill="#a0a0a0" font-size="9">${Math.round(graph.xMax)}</text>
                    </svg>
                `;
            }

            let html = `
                <div class="section-title age">Age Distribution</div>
                <div class="data-card age-card">
                    <div class="dist-chart-container">${graphSVG}</div>
                    <div class="stat-grid">
                        <div class="stat-box">
                            <span class="stat-label">Mean Age (Î¼)</span>
                            <span class="stat-value" style="color:var(--accent-orange)">${age.mean} yrs</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-label">Sigma (Ïƒ)</span>
                            <span class="stat-value">Â±${age.sigma} yrs</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-label">Primary Bracket</span>
                            <span class="stat-value">${age.bracket}</span>
                        </div>
                    </div>
                    <div class="nuance-text" style="border-color:var(--accent-orange)">${age.nuance}</div>
                </div>
            `;

            // Age Cohort Breakdown
            if (age.cohorts) {
                html += `
                    <div class="section-title age">Age Cohort Breakdown</div>
                    <div class="data-card">
                `;
                Object.entries(age.cohorts).forEach(([cohort, pct]) => {
                    const barWidth = pct;
                    html += `
                        <div style="margin-bottom:12px;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                                <span style="font-size:11px; font-weight:700; color:#a0a0a0;">${cohort}</span>
                                <span style="font-size:11px; font-weight:700; color:var(--accent-orange);">${pct}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width:${barWidth}%; background:var(--accent-orange);"></div>
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            // Experience Premium
            if (age.experiencePremium) {
                const ep = age.experiencePremium;
                html += `
                    <div class="section-title age">Experience Premium Curve</div>
                    <div class="data-card">
                        <div class="stat-grid" style="grid-template-columns:1fr 1fr 1fr;">
                            <div class="stat-box">
                                <span class="stat-label">Entry (0-3yr)</span>
                                <span class="stat-value" style="font-size:13px;">${formatCurrency(ep.entry)}</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Mid (4-10yr)</span>
                                <span class="stat-value" style="font-size:13px; color:var(--accent-blue);">${formatCurrency(ep.mid)}</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Senior (11+yr)</span>
                                <span class="stat-value" style="font-size:13px;">${formatCurrency(ep.senior)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            return html;
        }

        function renderFinancialTab(data) {
            if (!data.financial || data.financial.mean <= 0) return '';
            
            const fin = data.financial;
            let html = '';

            // Distribution Curve
            const w = 400, h = 90;
            const graph = getLogNormalPoints(fin.mean, fin.sigma, w, h);
            let graphSVG = "";
            if(graph) {
                const xMean = graph.xScale(fin.mean);
                graphSVG = `
                    <svg width="100%" height="100%" viewBox="0 0 ${w} ${h}">
                        <path d="${graph.path}" fill="rgba(59, 130, 246, 0.1)" stroke="none" />
                        <path d="${graph.linePath}" fill="none" stroke="#3b82f6" stroke-width="2" />
                        <line x1="${xMean}" y1="0" x2="${xMean}" y2="${h}" stroke="#3b82f6" stroke-width="1" stroke-dasharray="4,2"/>
                        <text x="${xMean+5}" y="15" fill="#3b82f6" font-size="10" font-weight="bold">AVG</text>
                    </svg>
                `;
            }

            html += `
                <div class="section-title fin">Income Distribution</div>
                <div class="data-card">
                    <div class="dist-chart-container">${graphSVG}</div>
                    <div class="stat-grid">
                        <div class="stat-box">
                            <span class="stat-label">Mean Income</span>
                            <span class="stat-value" style="color:var(--accent-blue)">${formatCurrency(fin.mean)}</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-label">Std Deviation</span>
                            <span class="stat-value">Â±${formatCurrency(fin.sigma)}</span>
                        </div>
                    </div>
                    <div class="nuance-text" style="border-color:var(--accent-blue)">${fin.nuance}</div>
                </div>
            `;

            // Percentile Ladder
            if (fin.percentiles) {
                const p = fin.percentiles;
                html += `
                    <div class="section-title fin">Percentile Breakdown</div>
                    <div class="data-card">
                        <div class="percentile-ladder">
                            <div class="percentile-row">
                                <span class="percentile-label">P90 (Top 10%)</span>
                                <span class="percentile-value">${formatCurrency(p.p90)}</span>
                            </div>
                            <div class="percentile-row">
                                <span class="percentile-label">P75 (Upper Quartile)</span>
                                <span class="percentile-value">${formatCurrency(p.p75)}</span>
                            </div>
                            <div class="percentile-row highlight">
                                <span class="percentile-label">P50 (MEDIAN)</span>
                                <span class="percentile-value">${formatCurrency(p.p50)}</span>
                            </div>
                            <div class="percentile-row">
                                <span class="percentile-label">P25 (Lower Quartile)</span>
                                <span class="percentile-value">${formatCurrency(p.p25)}</span>
                            </div>
                            <div class="percentile-row">
                                <span class="percentile-label">P10 (Bottom 10%)</span>
                                <span class="percentile-value">${formatCurrency(p.p10)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Geographic Variance
            if (fin.geographic) {
                const geo = fin.geographic;
                const calcDelta = (val) => Math.round(((val - fin.mean) / fin.mean) * 100);
                html += `
                    <div class="section-title fin">Geographic Salary Variance</div>
                    <div class="data-card">
                        <div class="geo-grid">
                            <div class="geo-item">
                                <div class="geo-city">ðŸŒ Bay Area</div>
                                <div class="geo-salary">${formatCurrency(geo.bayArea)}</div>
                                <div class="geo-delta" style="color:var(--accent-green);">+${calcDelta(geo.bayArea)}%</div>
                            </div>
                            <div class="geo-item">
                                <div class="geo-city">ðŸ—½ NYC</div>
                                <div class="geo-salary">${formatCurrency(geo.nyc)}</div>
                                <div class="geo-delta" style="color:var(--accent-green);">+${calcDelta(geo.nyc)}%</div>
                            </div>
                            <div class="geo-item">
                                <div class="geo-city">ðŸ¤  Austin</div>
                                <div class="geo-salary">${formatCurrency(geo.austin)}</div>
                                <div class="geo-delta" style="color:${calcDelta(geo.austin) >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${calcDelta(geo.austin)}%</div>
                            </div>
                            <div class="geo-item">
                                <div class="geo-city">ðŸŒ¾ Rural</div>
                                <div class="geo-salary">${formatCurrency(geo.rural)}</div>
                                <div class="geo-delta" style="color:var(--accent-red);">${calcDelta(geo.rural)}%</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Compensation Breakdown
            if (fin.compensation) {
                const comp = fin.compensation;
                const total = comp.base + comp.bonus + comp.stock + comp.benefits;
                html += `
                    <div class="section-title fin">Total Compensation Breakdown</div>
                    <div class="data-card">
                        <div style="margin-bottom:16px;">
                            <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:8px;">
                                <span>Base Salary (${Math.round(comp.base/total*100)}%)</span>
                                <span style="font-weight:700;">${formatCurrency(comp.base)}</span>
                            </div>
                            <div class="progress-bar" style="height:12px;">
                                <div class="progress-fill" style="width:${comp.base/total*100}%; background:#3b82f6;"></div>
                            </div>
                        </div>
                        <div class="stat-grid" style="grid-template-columns:1fr 1fr 1fr; gap:8px; font-size:11px;">
                            <div class="stat-box">
                                <span class="stat-label">Bonus</span>
                                <span class="stat-value" style="font-size:13px;">${formatCurrency(comp.bonus)}</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Stock</span>
                                <span class="stat-value" style="font-size:13px;">${formatCurrency(comp.stock)}</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Benefits</span>
                                <span class="stat-value" style="font-size:13px;">${formatCurrency(comp.benefits)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Purchasing Power
            if (fin.purchasingPower) {
                const pp = fin.purchasingPower;
                html += `
                    <div class="section-title fin">Purchasing Power (CoL Adjusted)</div>
                    <div class="data-card">
                        <p style="font-size:12px; color:#a0a0a0; margin-bottom:12px;">Real income after cost of living adjustments:</p>
                        <div class="geo-grid">
                            <div class="geo-item"><div class="geo-city">Bay Area</div><div class="geo-salary">${formatCurrency(pp.bayArea)}</div></div>
                            <div class="geo-item"><div class="geo-city">NYC</div><div class="geo-salary">${formatCurrency(pp.nyc)}</div></div>
                            <div class="geo-item"><div class="geo-city">Austin</div><div class="geo-salary">${formatCurrency(pp.austin)}</div></div>
                            <div class="geo-item"><div class="geo-city">Rural</div><div class="geo-salary">${formatCurrency(pp.rural)}</div></div>
                        </div>
                    </div>
                `;
            }

            // Career Trajectory
            if (fin.trajectory) {
                const traj = fin.trajectory;
                html += `
                    <div class="section-title fin">Career Salary Trajectory</div>
                    <div class="data-card">
                        <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:8px; text-align:center;">
                            <div style="padding:10px; background:#1a1a1a; border-radius:6px;">
                                <div style="font-size:10px; color:#808080; margin-bottom:4px;">Year 1</div>
                                <div style="font-size:14px; font-weight:800; color:#ffffff;">${formatCurrency(traj.year1)}</div>
                            </div>
                            <div style="padding:10px; background:#1a1a1a; border-radius:6px;">
                                <div style="font-size:10px; color:#808080; margin-bottom:4px;">Year 5</div>
                                <div style="font-size:14px; font-weight:800; color:#ffffff;">${formatCurrency(traj.year5)}</div>
                            </div>
                            <div style="padding:10px; background:#1a1a1a; border-radius:6px;">
                                <div style="font-size:10px; color:#808080; margin-bottom:4px;">Year 10</div>
                                <div style="font-size:14px; font-weight:800; color:#ffffff;">${formatCurrency(traj.year10)}</div>
                            </div>
                            <div style="padding:10px; background:#1a1a1a; border-radius:6px;">
                                <div style="font-size:10px; color:#808080; margin-bottom:4px;">Year 20</div>
                                <div style="font-size:14px; font-weight:800; color:var(--accent-green);">${formatCurrency(traj.year20)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            return html;
        }

        function renderAITab(data) {
            if (!data.ai) return '';
            
            const ai = data.ai;
            let html = '';

            // Detailed Mechanism
            if (ai.mechDetail) {
                html += `
                    <div class="section-title ai">Mechanism of Action</div>
                    <div class="data-card ai-card">
                        <p style="font-size:13px; line-height:1.6; color:#e0e0e0;">${ai.mechDetail}</p>
                    </div>
                `;
            } else {
                html += `
                    <div class="section-title ai">Mechanism</div>
                    <div class="data-card ai-card">
                        <div class="mech-text"><strong>Impact:</strong> ${ai.mech}</div>
                    </div>
                `;
            }

            // Timeline with Confidence Intervals
            const getTrendClass = (v) => {
                if(v.includes("+") || v === "Faster") return "pos";
                if(v.includes("-") || v === "Crisis") return "neg";
                return "neu";
            };

            html += `
                <div class="section-title ai">Employment Impact Forecast</div>
                <div class="data-card ai-card">
                    <div class="timeline-grid">
                        <div class="time-col">
                            <span class="time-head">2-Year</span>
                            <span class="time-val ${getTrendClass(ai.t2)}">${ai.t2}</span>
                        </div>
                        <div class="time-col">
                            <span class="time-head">5-Year</span>
                            <span class="time-val ${getTrendClass(ai.t5)}">${ai.t5}</span>
                        </div>
                        <div class="time-col">
                            <span class="time-head">10-Year</span>
                            <span class="time-val ${getTrendClass(ai.t10)}">${ai.t10}</span>
                        </div>
                    </div>
            `;

            if (ai.confidenceIntervals) {
                const ci = ai.confidenceIntervals;
                html += `
                    <div style="margin-top:16px; font-size:11px; color:#a0a0a0;">
                        <div style="font-weight:700; margin-bottom:8px; color:#ffffff;">Confidence Intervals:</div>
                        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; font-size:10px;">
                            <div>2yr: ${ci.t2.low}% to +${ci.t2.high}%</div>
                            <div>5yr: ${ci.t5.low}% to +${ci.t5.high}%</div>
                            <div>10yr: ${ci.t10.low}% to +${ci.t10.high}%</div>
                        </div>
                    </div>
                `;
            }

            html += `</div>`;

            // Task Automation Breakdown
            if (ai.taskDecomposition) {
                html += `
                    <div class="section-title ai">Task Automation Analysis</div>
                    <div class="data-card">
                `;
                ai.taskDecomposition.forEach(task => {
                    const color = task.automatable > 60 ? '#ef4444' : task.automatable > 30 ? '#f59e0b' : '#10b981';
                    html += `
                        <div class="task-bar">
                            <div class="task-name">${task.task}</div>
                            <div class="task-progress-bar">
                                <div class="task-progress-fill" style="width:${task.automatable}%; background:${color};">
                                    ${task.automatable}%
                                </div>
                            </div>
                        </div>
                        <div class="task-desc">${task.desc}</div>
                    `;
                });
                html += `</div>`;
            }

            // Transition Pathways
            if (ai.transitionPaths) {
                html += `
                    <div class="section-title ai">Career Transition Pathways</div>
                `;
                ai.transitionPaths.forEach(path => {
                    const diffBadge = path.difficulty === 'high' ? 'ðŸ”´ High' : path.difficulty === 'medium' ? 'ðŸŸ¡ Med' : 'ðŸŸ¢ Low';
                    html += `
                        <div class="transition-card">
                            <div class="transition-title">â†’ ${path.to}</div>
                            <div class="transition-meta">Difficulty: ${diffBadge} | Timeframe: ${path.timeframe}</div>
                        </div>
                    `;
                });
            }


            return html;
        }

        function renderLaborMarketTab(data) {
            if (!data.laborMarket) return '';
            
            const lm = data.laborMarket;
            let html = '';

            // Supply & Demand
            if (lm.supplyDemand) {
                const sd = lm.supplyDemand;
                const status = sd.ratio > 0.15 ? 'ðŸ”´ SHORTAGE' : sd.ratio > 0.05 ? 'ðŸŸ¢ HIGH DEMAND' : 'ðŸŸ¡ BALANCED';
                html += `
                    <div class="section-title">Supply & Demand</div>
                    <div class="data-card">
                        <div class="stat-grid">
                            <div class="stat-box">
                                <span class="stat-label">Job Openings</span>
                                <span class="stat-value">${(sd.openings/1000).toFixed(0)}K</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Total Workers</span>
                                <span class="stat-value">${(sd.workers/1000000).toFixed(1)}M</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Ratio</span>
                                <span class="stat-value">${(sd.ratio * 100).toFixed(1)}%</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Status</span>
                                <span class="stat-value" style="font-size:13px;">${status}</span>
                            </div>
                        </div>
                        <div style="margin-top:12px; padding:8px; background:${sd.trend === 'growing' ? '#0f1a0f' : '#1a0f0f'}; border-radius:6px; font-size:11px; color:#ffffff;">
                            ðŸ“Š Trend: <strong style="text-transform:uppercase;">${sd.trend}</strong>
                        </div>
                    </div>
                `;
            }

            // Entry Barriers
            if (lm.entryBarriers) {
                const eb = lm.entryBarriers;
                html += `
                    <div class="section-title">Entry Barriers</div>
                    <div class="data-card">
                        <div class="stat-grid" style="grid-template-columns:1fr 1fr 1fr;">
                            <div class="stat-box">
                                <span class="stat-label">Education</span>
                                <span class="stat-value">${eb.educationYears} yrs</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Cert Cost</span>
                                <span class="stat-value">${formatCurrency(eb.certificationCost)}</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Time to Job</span>
                                <span class="stat-value">${eb.timeToCompetency} yrs</span>
                            </div>
                        </div>
                        <div style="margin-top:12px;">
                            <div style="font-size:11px; color:#808080; margin-bottom:6px;">Difficulty Level:</div>
                            <div style="display:flex; gap:4px;">
                                ${Array(5).fill(0).map((_, i) => {
                                    const filled = i < Math.ceil(eb.educationYears / 1.5);
                                    return `<div style="flex:1; height:8px; background:${filled ? '#f59e0b' : '#2a2a2a'}; border-radius:2px;"></div>`;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            // Market Health
            html += `
                <div class="section-title">Market Health Metrics</div>
                <div class="data-card">
                    <div style="display:flex; flex-direction:column; gap:12px;">
                        <div style="display:flex; justify-content:space-between; padding:10px; background:#1a1a1a; border-radius:6px;">
                            <span style="font-size:11px; color:#808080;">Annual Turnover</span>
                            <span style="font-size:14px; font-weight:700; color:#ffffff;">${(lm.turnover * 100).toFixed(0)}%</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; padding:10px; background:#1a1a1a; border-radius:6px;">
                            <span style="font-size:11px; color:#808080;">Historic Growth (2015-25)</span>
                            <span style="font-size:14px; font-weight:700; color:var(--accent-green);">+${(lm.growth.historic * 100).toFixed(0)}%/yr</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; padding:10px; background:#0f1520; border-radius:6px;">
                            <span style="font-size:11px; color:#60a5fa;">Projected Growth (2025-35)</span>
                            <span style="font-size:14px; font-weight:700; color:var(--accent-blue);">+${(lm.growth.projected * 100).toFixed(0)}%/yr</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; padding:10px; background:#1a1a1a; border-radius:6px;">
                            <span style="font-size:11px; color:#808080;">Union Density</span>
                            <span style="font-size:14px; font-weight:700; color:#ffffff;">${(lm.unionDensity * 100).toFixed(0)}%</span>
                        </div>
                    </div>
                </div>
            `;

            return html;
        }

        function renderRiskTab(data) {
            if (!data.risk) return '<p style="color:#a0aec0; padding:20px;">No risk profile data available.</p>';
            
            const risk = data.risk;
            let html = '';

            // Automation Risk Gauge
            const riskScore = risk.automationRiskScore;
            const riskLevel = riskScore > 70 ? 'HIGH RISK' : riskScore > 40 ? 'MODERATE' : 'LOW RISK';
            const riskColor = riskScore > 70 ? '#ef4444' : riskScore > 40 ? '#f59e0b' : '#10b981';

            html += `
                <div class="section-title" style="color:${riskColor};">Automation Risk Score</div>
                <div class="data-card">
                    <div class="risk-gauge">
                        <div class="risk-score" style="color:${riskColor};">${riskScore}</div>
                        <div class="risk-label" style="color:${riskColor};">${riskLevel}</div>
                        <div class="risk-bar-container">
                            <div class="risk-indicator" style="left:${riskScore}%;"></div>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-top:8px; font-size:10px; color:#94a3b8;">
                            <span>0 (Safe)</span>
                            <span>50</span>
                            <span>100 (High Risk)</span>
                        </div>
                    </div>
                </div>
            `;

            // Risk Factors Breakdown
            html += `
                <div class="section-title">Risk Factor Analysis</div>
                <div class="data-card">
                    <div style="display:flex; flex-direction:column; gap:10px;">
                        <div style="padding:10px; background:#f8fafc; border-radius:6px; border-left:3px solid ${riskColor};">
                            <div style="font-size:11px; color:#718096; margin-bottom:4px;">ðŸ¤– Automation Risk</div>
                            <div style="font-size:16px; font-weight:800;">${riskScore}/100</div>
                        </div>
                        <div style="padding:10px; background:#f8fafc; border-radius:6px;">
                            <div style="font-size:11px; color:#718096; margin-bottom:4px;">ðŸ“‰ Economic Sensitivity</div>
                            <div style="font-size:14px; font-weight:700; text-transform:capitalize;">${risk.economicSensitivity}</div>
                        </div>
                        <div style="padding:10px; background:#f8fafc; border-radius:6px;">
                            <div style="font-size:11px; color:#718096; margin-bottom:4px;">ðŸ”„ Skill Transferability</div>
                            <div style="font-size:14px; font-weight:700; text-transform:capitalize;">${risk.skillTransferability}</div>
                        </div>
                        <div style="padding:10px; background:#f8fafc; border-radius:6px;">
                            <div style="font-size:11px; color:#718096; margin-bottom:4px;">ðŸ¦¾ Physical Constraint</div>
                            <div style="font-size:14px; font-weight:700; text-transform:capitalize;">${risk.physicalConstraint}</div>
                        </div>
                        <div style="padding:10px; background:#f8fafc; border-radius:6px;">
                            <div style="font-size:11px; color:#718096; margin-bottom:4px;">âš–ï¸ Regulatory Moat</div>
                            <div style="font-size:14px; font-weight:700; text-transform:capitalize;">${risk.regulatoryMoat}</div>
                        </div>
                    </div>
                </div>
            `;

            // Resilience Strategy
            html += `
                <div class="data-card" style="background:#eff6ff; border-color:#3b82f6;">
                    <div style="font-size:11px; font-weight:800; color:#1e40af; margin-bottom:8px; text-transform:uppercase;">ðŸ’¼ Resilience Strategy</div>
                    <ul style="margin:0; padding-left:20px; font-size:12px; line-height:1.8; color:#1e3a8a;">
                        <li>Continuously upskill in areas AI cannot replicate</li>
                        <li>Build soft skills (leadership, communication)</li>
                        <li>Focus on system thinking vs task execution</li>
                    </ul>
                </div>
            `;

            return html;
        }

        function renderComparisonsTab(data) {
            if (!data.comparative) return '<p style="color:#a0aec0; padding:20px;">No comparison data available.</p>';
            
            const comp = data.comparative;
            let html = '';

            // Similar Roles
            if (comp.similarRoles) {
                html += `
                    <div class="section-title">Similar Occupations</div>
                    <div class="data-card">
                        <table style="width:100%; font-size:12px; border-collapse:collapse;">
                            <thead>
                                <tr style="border-bottom:2px solid var(--border-color);">
                                    <th style="text-align:left; padding:8px; font-size:10px; color:#718096; font-weight:700;">ROLE</th>
                                    <th style="text-align:right; padding:8px; font-size:10px; color:#718096; font-weight:700;">SALARY</th>
                                    <th style="text-align:right; padding:8px; font-size:10px; color:#718096; font-weight:700;">AI IMPACT</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background:#ebf8ff; font-weight:700;">
                                    <td style="padding:10px; border-radius:4px;">This Job</td>
                                    <td style="text-align:right; padding:10px;">${formatCurrency(data.financial.mean)}</td>
                                    <td style="text-align:right; padding:10px; color:var(--accent-blue);">â€”</td>
                                </tr>
                `;
                comp.similarRoles.forEach(role => {
                    const impactColor = role.aiImpact.includes('+') ? 'var(--accent-green)' : role.aiImpact.includes('-') ? 'var(--accent-red)' : '#718096';
                    html += `
                        <tr style="border-bottom:1px solid var(--border-color);">
                            <td style="padding:10px;">${role.name}</td>
                            <td style="text-align:right; padding:10px; font-weight:600;">${formatCurrency(role.salary)}</td>
                            <td style="text-align:right; padding:10px; font-weight:700; color:${impactColor};">${role.aiImpact}</td>
                        </tr>
                    `;
                });
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }

            // National Benchmark
            if (comp.nationalBenchmark) {
                const nb = comp.nationalBenchmark;
                html += `
                    <div class="section-title">National Context</div>
                    <div class="data-card">
                        <div style="display:flex; flex-direction:column; gap:12px;">
                            <div style="display:flex; justify-content:space-between; padding:12px; background:#f0fdf4; border-radius:6px;">
                                <span style="font-size:12px; color:#166534;">vs. Median US Income</span>
                                <span style="font-size:18px; font-weight:800; color:var(--accent-green);">${nb.vsMedianIncome.toFixed(1)}x</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; padding:12px; background:#f0fdf4; border-radius:6px;">
                                <span style="font-size:12px; color:#166534;">vs. Median College Grad</span>
                                <span style="font-size:18px; font-weight:800; color:var(--accent-green);">${nb.vsMedianCollege.toFixed(1)}x</span>
                            </div>
                        </div>
                        <div style="margin-top:12px; padding:8px; background:#eff6ff; border-radius:6px; font-size:11px; color:#1e40af;">
                            ðŸ’¡ This role earns <strong>${((nb.vsMedianIncome - 1) * 100).toFixed(0)}% above</strong> the typical American.
                        </div>
                    </div>
                `;
            }

            // Historical Purchasing Power
            if (comp.historicalPurchasing) {
                const hp = comp.historicalPurchasing;
                const growth80to24 = ((hp.year2024 - hp.year1980) / hp.year1980 * 100).toFixed(0);
                html += `
                    <div class="section-title">Historical Purchasing Power</div>
                    <div class="data-card">
                        <p style="font-size:11px; color:#718096; margin-bottom:12px;">Salary adjusted for inflation (2024 dollars):</p>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <div style="display:flex; justify-content:space-between; padding:8px; background:#f8fafc; border-radius:6px;">
                                <span style="font-size:11px; color:#718096;">ðŸ•°ï¸ 1980</span>
                                <span style="font-size:14px; font-weight:700;">${formatCurrency(hp.year1980)}</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; padding:8px; background:#f8fafc; border-radius:6px;">
                                <span style="font-size:11px; color:#718096;">ðŸ“ˆ 2000</span>
                                <span style="font-size:14px; font-weight:700;">${formatCurrency(hp.year2000)}</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; padding:8px; background:#ecfdf5; border-radius:6px;">
                                <span style="font-size:11px; color:#166534;">âœ¨ 2024</span>
                                <span style="font-size:14px; font-weight:700; color:var(--accent-green);">${formatCurrency(hp.year2024)}</span>
                            </div>
                        </div>
                        <div style="margin-top:12px; padding:8px; background:#ecfdf5; border-radius:6px; font-size:11px; color:#065f46;">
                            ðŸ“Š Real wage growth: <strong>+${growth80to24}%</strong> over 44 years
                        </div>
                    </div>
                `;
            }

            return html;
        }

        function renderQualityTab(data) {
            if (!data.hidden) return '<p style="color:#a0aec0; padding:20px;">No quality of life data available.</p>';
            
            const hidden = data.hidden;
            let html = '';

            // Work-Life Metrics
            if (hidden.workLifeMetrics) {
                const wl = hidden.workLifeMetrics;
                html += `
                    <div class="section-title">Work-Life Profile</div>
                    <div class="data-card">
                        <div style="padding:12px; background:#f8fafc; border-radius:8px; margin-bottom:12px;">
                            <div style="font-size:11px; color:#718096; margin-bottom:6px;">â° Average Hours/Week</div>
                            <div style="font-size:24px; font-weight:800; color:#2d3748;">${wl.avgHoursPerWeek}</div>
                            <div class="progress-bar" style="margin-top:8px; height:6px;">
                                <div class="progress-fill" style="width:${(wl.avgHoursPerWeek / 60) * 100}%; background:${wl.avgHoursPerWeek > 50 ? '#ef4444' : '#10b981'};"></div>
                            </div>
                        </div>

                        <div style="padding:12px; background:#f8fafc; border-radius:8px; margin-bottom:12px;">
                            <div style="font-size:11px; color:#718096; margin-bottom:6px;">ðŸ˜° Stress Index</div>
                            <div style="font-size:24px; font-weight:800; color:#2d3748;">${wl.stressIndex}/10</div>
                            <div class="progress-bar" style="margin-top:8px; height:6px;">
                                <div class="progress-fill" style="width:${wl.stressIndex * 10}%; background:linear-gradient(90deg, #10b981, #fbbf24, #ef4444);"></div>
                            </div>
                        </div>

                        <div style="padding:12px; background:#f8fafc; border-radius:8px; margin-bottom:12px;">
                            <div style="font-size:11px; color:#718096; margin-bottom:6px;">ðŸ”¥ Annual Burnout Rate</div>
                            <div style="font-size:24px; font-weight:800; color:#ef4444;">${(wl.burnoutRate * 100).toFixed(0)}%</div>
                        </div>

                        <div style="padding:12px; background:#ecfdf5; border-radius:8px;">
                            <div style="font-size:11px; color:#166534; margin-bottom:6px;">ðŸ  Remote Work Eligible</div>
                            <div style="font-size:24px; font-weight:800; color:var(--accent-green);">${(wl.remoteEligibility * 100).toFixed(0)}%</div>
                            <div class="progress-bar" style="margin-top:8px; height:6px;">
                                <div class="progress-fill" style="width:${wl.remoteEligibility * 100}%; background:var(--accent-green);"></div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Job Satisfaction
            if (hidden.satisfactionIndex) {
                const sat = hidden.satisfactionIndex;
                const satColor = sat > 7 ? '#10b981' : sat > 5 ? '#f59e0b' : '#ef4444';
                html += `
                    <div class="section-title">Job Satisfaction</div>
                    <div class="data-card">
                        <div style="text-align:center; padding:20px;">
                            <div style="font-size:48px; font-weight:800; color:${satColor};">${sat}/10</div>
                            <div class="progress-bar" style="margin-top:12px; height:10px;">
                                <div class="progress-fill" style="width:${sat * 10}%; background:${satColor};"></div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Total Compensation Value
            if (hidden.benefitsValue && data.financial) {
                const totalComp = data.financial.mean + hidden.benefitsValue;
                html += `
                    <div class="section-title">True Compensation Value</div>
                    <div class="data-card">
                        <div style="display:flex; justify-content:space-between; padding:10px; background:#f8fafc; border-radius:6px; margin-bottom:8px;">
                            <span style="font-size:12px; color:#718096;">ðŸ’µ Cash Salary</span>
                            <span style="font-size:14px; font-weight:700;">${formatCurrency(data.financial.mean)}</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; padding:10px; background:#f8fafc; border-radius:6px; margin-bottom:8px;">
                            <span style="font-size:12px; color:#718096;">ðŸ¥ Benefits Value</span>
                            <span style="font-size:14px; font-weight:700;">${formatCurrency(hidden.benefitsValue)}</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; padding:12px; background:#ecfdf5; border-radius:6px;">
                            <span style="font-size:12px; color:#166534; font-weight:700;">ðŸ’° TOTAL</span>
                            <span style="font-size:18px; font-weight:800; color:var(--accent-green);">${formatCurrency(totalComp)}</span>
                        </div>
                    </div>
                `;
            }

            return html;
        }

        function renderStoriesTab(data) {
            if (!data.narratives) return '<p style="color:#a0aec0; padding:20px;">No narrative data available.</p>';
            
            const narr = data.narratives;
            let html = '';

            // Case Studies
            if (narr.caseStudies) {
                html += `<div class="section-title">Worker Profiles</div>`;
                narr.caseStudies.forEach(study => {
                    html += `<div class="case-study">ðŸ“– ${study}</div>`;
                });
            }

            // Policy Implications
            if (narr.policyImplications) {
                html += `
                    <div class="section-title">Policy Implications</div>
                    <div class="data-card" style="background:#faf5ff; border-color:#e9d5ff;">
                        <p style="font-size:12px; line-height:1.6; color:#4c1d95; margin:0;">${narr.policyImplications}</p>
                    </div>
                `;
            }

            // Future Scenarios
            if (narr.scenarios) {
                html += `<div class="section-title">Future Scenarios (2036)</div>`;
                
                if (narr.scenarios.best) {
                    html += `
                        <div class="scenario-box best">
                            <div class="scenario-title" style="color:#166534;">ðŸŒŸ BEST CASE</div>
                            <div class="scenario-text" style="color:#14532d;">${narr.scenarios.best}</div>
                        </div>
                    `;
                }
                
                if (narr.scenarios.likely) {
                    html += `
                        <div class="scenario-box likely">
                            <div class="scenario-title" style="color:#1e40af;">ðŸ“Š MOST LIKELY</div>
                            <div class="scenario-text" style="color:#1e3a8a;">${narr.scenarios.likely}</div>
                        </div>
                    `;
                }
                
                if (narr.scenarios.worst) {
                    html += `
                        <div class="scenario-box worst">
                            <div class="scenario-title" style="color:#991b1b;">âš ï¸ WORST CASE</div>
                            <div class="scenario-text" style="color:#7f1d1d;">${narr.scenarios.worst}</div>
                        </div>
                    `;
                }
            }

            return html;
        }

        window.addEventListener('load', initChart);
        window.addEventListener('resize', () => { setTimeout(initChart, 200); });

    </script>
</body>
</html>
